# üì¶ Ecommerce Backend ‚Äî Comisi√≥n 85460

**Pre-Entrega N¬∞1 ‚Äî Backend 2 (Coderhouse)**  
Desarrollado por: [**Gonzalo Veglio**](https://www.linkedin.com/in/gonzalo-nahuel-veglio/)

---

## üöÄ Descripci√≥n

Este proyecto implementa un **CRUD de usuarios** junto con un sistema de **autenticaci√≥n y autorizaci√≥n** utilizando **Passport** y **JWT**, siguiendo la estructura de un backend para ecommerce.

Incluye:
- Modelo `User` con campos requeridos y referencia a `Cart`.
- Contrase√±a encriptada con **bcrypt**.
- Estrategia **passport-local** para login.
- Estrategia **passport-jwt** para rutas protegidas.
- Sistema de login que genera un **token JWT**.
- Endpoint `/api/sessions/current` protegido.
- **Vistas frontend**: login, registro y usuario actual, desarrolladas en HTML y CSS moderno.

---
 
## ‚öôÔ∏è Tecnolog√≠as utilizadas

- ![Node.js](https://img.shields.io/badge/-Node.js-339933?logo=node.js&logoColor=white) **Node.js**
- ![Express](https://img.shields.io/badge/-Express.js-000000?logo=express&logoColor=white) **Express**
- ![MongoDB](https://img.shields.io/badge/-MongoDB-47A248?logo=mongodb&logoColor=white) **MongoDB** + **Mongoose**
- ![Passport](https://img.shields.io/badge/-Passport.js-34E27A?logo=passport&logoColor=white) **Passport**, **passport-local**, **passport-jwt**
- üîí **bcrypt**, **jsonwebtoken**
- ‚öôÔ∏è **dotenv**
- üé® **HTML5** y **CSS3** para las vistas de login, registro y usuario actual

---

## üìÅ Estructura base

```
/public
  index.html
  login.html
  register.html
  current.html
  users.html
  css/
    style.css
  img/
    favicon.svg
/src
  config/
    db.js
    passport.config.js
  controllers/
    user.controller.js
    session.controller.js
  models/
    Users.js
  routes/
    user.routes.js
    session.routes.js
  utils/
  server.js
.env
README.MD
package.json
```

Las vistas principales incluidas son:
- **login.html**: formulario de inicio de sesi√≥n
- **register.html**: formulario de registro de usuario
- **current.html**: muestra los datos del usuario autenticado
- **users.html**: muestra todos los usuario de la base de datos



## üõ†Ô∏è Cambios realizados y mejoras

### Refactorizaciones y arquitectura
- Implementaci√≥n completa de los patrones DAO y Repository para todas las entidades principales (User, Product, Cart, Ticket), desacoplando la l√≥gica de acceso a datos de los controladores.
- Refactorizaci√≥n de todos los controladores para utilizar los repositorios y DTOs, mejorando la mantenibilidad y seguridad.
- Centralizaci√≥n de la l√≥gica de autorizaci√≥n por roles mediante middlewares reutilizables (`adminOnly`, `userOnly`).
- Validaciones manuales de entrada en los endpoints cr√≠ticos para asegurar integridad de datos.

### Funcionalidades nuevas
- L√≥gica de compra completa: validaci√≥n de stock, generaci√≥n de ticket, actualizaci√≥n autom√°tica del carrito y registro de la compra.
- **Env√≠o autom√°tico del ticket por email** al usuario al finalizar la compra, usando Nodemailer.
- Recuperaci√≥n de contrase√±a v√≠a email con token seguro y expiraci√≥n, usando Nodemailer.
- Asociaci√≥n autom√°tica de carrito al momento de registro de usuario.
- Endpoint `/api/sessions/current` protegido y que retorna un DTO seguro del usuario autenticado.
 
### Seguridad
- Encriptaci√≥n de contrase√±as con bcrypt.
- Uso de JWT para autenticaci√≥n y autorizaci√≥n en endpoints protegidos.
- Filtrado de datos sensibles mediante DTOs.

### Frontend
- Se incluyeron vistas HTML/CSS b√°sicas √∫nicamente para visualizar informaci√≥n y probar el flujo de autenticaci√≥n/registro. No es un frontend productivo ni responsivo.

---

## üöÄ Mejoras sugeridas a futuro

- Implementar DTOs para productos y tickets para mayor control de la salida de datos.
- Mejorar el manejo de errores y mensajes personalizados en todas las rutas.
- Agregar tests automatizados (unitarios/integraci√≥n) para endpoints y l√≥gica de negocio.
- Internacionalizaci√≥n de mensajes y respuestas.
- Mejorar el frontend con un framework moderno (React, Vue, etc.) y consumir la API de manera real.
- Implementar paginaci√≥n, filtros y ordenamiento en endpoints de productos y usuarios.
- Agregar logs centralizados y monitoreo de errores.
- Permitir al usuario descargar el ticket en PDF o visualizarlo desde el frontend.

---

## üì¶ Instalaci√≥n

1. Clon√° el repositorio:  
   `git clone https://github.com/GonzaloNahuelVeglio/backend-ecommerce-85460`

2. Instal√° dependencias:  
   `npm install`

3. Configur√° tu archivo `.env`:
   ```
   MONGO_URI=<TU_URI_DE_MONGO>
   JWT_SECRET=<TU_SECRETO>
   PORT=8080
   ```

4. Para correr el servidor:  
   `npm run dev`

---

## üîë Pruebas principales (Postman)

### Crear usuario (registro)
- **POST** `/api/users`
- Body: `{ first_name, last_name, email, age, password }`

### Login de usuario
- **POST** `/api/sessions/login`
- Body: `{ email, password }`
- Respuesta: `{ token }`

### Obtener usuario actual (requiere JWT)
- **GET** `/api/sessions/current`
- Header: `Authorization: Bearer <token>`

### CRUD de usuarios (requiere JWT)

- **GET** `/api/users`  
  Lista todos los usuarios (protegido).

- **GET** `/api/users/:uid`  
  Obtiene un usuario por ID (no protegido).

- **PUT** `/api/users/:uid`  
  Actualiza un usuario por ID (protegido).

- **DELETE** `/api/users/:uid`  
  Elimina un usuario por ID (protegido).

---

## ‚ö° Autor

[Gonza Veglio](https://github.com/GonzaloNahuelVeglio)
Comisi√≥n 85460 ‚Äî Backend 2 ‚Äî Coderhouse

---
