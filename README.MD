
# üì¶ Ecommerce Backend ‚Äî Comisi√≥n 85460

Desarrollado por: [**Gonzalo Veglio**](https://www.linkedin.com/in/gonzalo-nahuel-veglio/)

---

## Tabla de Contenidos

- [Descripci√≥n](#descripci√≥n)
- [Tecnolog√≠as](#tecnolog√≠as)
- [Estructura del Proyecto](#estructura-del-proyecto)
- [DTOs](#dtos)
- [Roles y Middlewares](#roles-y-middlewares)
- [Endpoints](#endpoints)
- [Instalaci√≥n y Configuraci√≥n](#instalaci√≥n-y-configuraci√≥n)
- [Pruebas principales](#pruebas-principales)
- [Mejoras futuras](#mejoras-futuras)
- [Autor](#autor)

---

## Descripci√≥n

Backend profesional para ecommerce, implementando arquitectura por capas, patrones DAO/Repository, autenticaci√≥n y autorizaci√≥n con Passport (estrategias local y JWT), manejo de roles, l√≥gica de compra, tickets y mailing. Incluye vistas HTML/CSS para pruebas manuales.

---

## Tecnolog√≠as

- **Node.js**
- **Express**
- **MongoDB** + **Mongoose**
- **Passport** (local, jwt)
- **bcrypt**, **jsonwebtoken**
- **dotenv**
- **Nodemailer**
- **HTML5** y **CSS3** (vistas de prueba)

---

## Estructura del Proyecto

```
/public
  index.html
  login.html
  register.html
  current.html
  users.html
  products.html
  cart.html
  tickets.html
  forgot-password.html
  reset-password.html
  css/
    style.css
  img/
    favicon.svg
/src
  config/
    db.js
    passport.config.js
  controllers/
    user.controller.js
    session.controller.js
    product.controller.js
    cart.controller.js
    ticket.controller.js
    password.controller.js
    purchase.controller.js
  daos/
    user.dao.js
    product.dao.js
    cart.dao.js
    ticket.dao.js
  repositories/
    user.repository.js
    product.repository.js
    cart.repository.js
    ticket.repository.js
  DTO/
    user.dto.js
  middlewares/
    roleAuth.js
  models/
    Users.js
    Product.js
    Cart.js
    Ticket.js
  routes/
    user.routes.js
    session.routes.js
    product.routes.js
    cart.routes.js
    ticket.routes.js
    password.routes.js
  services/
    register.service.js
  server.js
.env
README.MD
package.json
```

---

## DTOs

Un DTO (Data Transfer Object) es un objeto que transfiere datos entre capas, evitando exponer informaci√≥n sensible o innecesaria. En este proyecto, los DTOs se usan especialmente en endpoints como `/current` para retornar solo los datos necesarios del usuario autenticado (por ejemplo, ocultando la contrase√±a y otros campos privados). Esto mejora la seguridad y la claridad de la API.

---

## Roles y Middlewares

El sistema implementa roles de usuario:

- **admin**: puede crear, actualizar y eliminar productos.
- **user**: puede listar productos y gestionar su propio carrito.

Los middlewares `adminOnly` y `userOnly` (en `src/middlewares/roleAuth.js`) protegen los endpoints seg√∫n el rol del usuario autenticado. Ejemplo: solo los administradores pueden acceder a rutas de creaci√≥n, edici√≥n y borrado de productos, mientras que los usuarios solo pueden agregar productos a su carrito y finalizar compras.

---

## Endpoints

### Usuarios y sesiones

- **POST** `/api/users` ‚Äî Crear usuario (registro)
- **POST** `/api/sessions/login` ‚Äî Login de usuario
- **GET** `/api/sessions/current` ‚Äî Obtener usuario actual (requiere JWT)
- **GET** `/api/users` ‚Äî Lista todos los usuarios (protegido)
- **GET** `/api/users/:uid` ‚Äî Obtiene un usuario por ID (no protegido)
- **PUT** `/api/users/:uid` ‚Äî Actualiza un usuario por ID (protegido)
- **DELETE** `/api/users/:uid` ‚Äî Elimina un usuario por ID (protegido)

### Productos

- **GET** `/api/products` ‚Äî Lista todos los productos
- **GET** `/api/products/:pid` ‚Äî Obtiene un producto por ID
- **POST** `/api/products` ‚Äî Crea un producto (solo admin)
- **PUT** `/api/products/:pid` ‚Äî Actualiza un producto (solo admin)
- **DELETE** `/api/products/:pid` ‚Äî Elimina un producto (solo admin)

### Carritos

- **POST** `/api/carts` ‚Äî Crea un carrito
- **GET** `/api/carts/:cid` ‚Äî Obtiene un carrito
- **POST** `/api/carts/:cid/products` ‚Äî Agrega producto al carrito (solo user)
- **DELETE** `/api/carts/:cid/products/:productId` ‚Äî Elimina producto del carrito (solo user)
- **POST** `/api/carts/:cid/purchase` ‚Äî Finaliza compra y genera ticket (solo user)

### Tickets

- **GET** `/api/tickets` ‚Äî Lista todos los tickets (protegido)
- **GET** `/api/tickets/:tid` ‚Äî Obtiene un ticket por ID (protegido)

### Recuperaci√≥n de contrase√±a

- **POST** `/api/password/request-reset` ‚Äî Solicita email de recuperaci√≥n
- **POST** `/api/password/reset` ‚Äî Cambia la contrase√±a usando el token recibido

---

## Instalaci√≥n y Configuraci√≥n

1. Clona el repositorio:
   ```bash
   git clone https://github.com/GonzaloNahuelVeglio/backend-ecommerce-85460
   ```
2. Instala dependencias:
   ```bash
   npm install
   ```
3. Configura tu archivo `.env`:
   ```env
   MONGO_URI=<tu_uri_mongodb>
   JWT_SECRET=<tu_clave_secreta_jwt>
   PORT=8080
   EMAIL_USER=<tu_email>
   EMAIL_PASS=<tu_contrase√±a>
   # EMAIL_HOST y EMAIL_PORT solo si no usas Gmail
   # EMAIL_HOST=smtp.example.com
   # EMAIL_PORT=587
   ```
   > ‚ö†Ô∏è Reemplaza los valores por tus datos reales. No compartas tu archivo `.env` ni tus credenciales. Si usas Gmail, EMAIL_HOST y EMAIL_PORT no son necesarios.
4. Inicia el servidor:
   ```bash
   npm run dev
   ```

---

## Pruebas principales

Puedes probar los endpoints con Postman o cualquier cliente HTTP. Ejemplos:

- **Crear usuario:**
  - POST `/api/users`
  - Body: `{ "first_name": "Juan", "last_name": "P√©rez", "email": "juan@mail.com", "age": 30, "password": "123456" }`
- **Login:**
  - POST `/api/sessions/login`
  - Body: `{ "email": "juan@mail.com", "password": "123456" }`
  - Respuesta: `{ "token": "..." }`
- **Obtener usuario actual:**
  - GET `/api/sessions/current`
  - Header: `Authorization: Bearer <token>`

---

## Mejoras futuras

- Implementar DTOs para productos y tickets para mayor control de la salida de datos.
- Mejorar el manejo de errores y mensajes personalizados en todas las rutas.
- Agregar tests automatizados (unitarios/integraci√≥n) para endpoints y l√≥gica de negocio.
- Internacionalizaci√≥n de mensajes y respuestas.
- Mejorar el frontend con un framework moderno (React, Vue, etc.) y consumir la API de manera real.
- Implementar paginaci√≥n, filtros y ordenamiento en endpoints de productos y usuarios.
- Agregar logs centralizados y monitoreo de errores.
- Permitir al usuario descargar el ticket en PDF o visualizarlo desde el frontend.

---

## Autor

[Gonza Veglio](https://github.com/GonzaloNahuelVeglio)  
Comisi√≥n 85460 ‚Äî Backend 2 ‚Äî Coderhouse

---
